<script>
    window.onload = function() {
      var anno = Annotorious.createImageAnnotator('my-image');
      // Load annotations from JSON files
      anno.loadAnnotations('./014_annotation.json');
 
      // 监听选中注释
      var selectedAnnotation = null;
      anno.on('selectionChanged', (annotations) => {
        if (annotations.length > 0) {
          const annotation = annotations[0]; // 假设只处理第一个选中的标注
          console.log('Selected annotation: ' + annotation.id);
          selectedAnnotation = annotation;
        } else {
          console.log('No annotation selected');
          selectedAnnotation = null;
        }
      });

      // 允许删除选中的注释
      window.addEventListener('keydown', function(event) {
        console.log("Selected Annotation:", selectedAnnotation); 
        if (event.key === 'Backspace' && selectedAnnotation) {
          anno.removeAnnotation(selectedAnnotation);
          selectedAnnotation = null;
        }
      });

      // Function to save annotations as a JSON file
      function saveAllAnnotations() {
        var allAnnotations = anno.getAnnotations();
        var jsonAnnotations = JSON.stringify(allAnnotations, null, 2);
        var blob = new Blob([jsonAnnotations], { type: 'application/json' });
        
        // Create a download link
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'all_annotations.json';  // Default download filename
        link.click();
      }

      // Add a button to trigger saving all annotations
      var saveButton = document.createElement('button');
      saveButton.innerText = 'Save All Annotations';
      saveButton.onclick = saveAllAnnotations;
      document.body.appendChild(saveButton);

      // Action button that updates the ID
      var actionButtons = document.querySelectorAll('button');
      actionButtons.forEach(button => {
        button.addEventListener('click', function() {
          if (selectedAnnotation) {
            // Find the corresponding sentence container by its ID
            var sentenceDiv = button.closest('.sentence-container');
            if (sentenceDiv && sentenceDiv._idParagraph) {
              // Update the ID paragraph with the selected annotation's ID
              sentenceDiv._idParagraph.textContent = `ID: ${selectedAnnotation.id}`;
            }
          }
        });
      });
    }
  </script>